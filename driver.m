%% Clear
clear all, close all, clc;

%% 2 Terms

% Set up
maxRep = 400;
ms = linspace(1.1, 20, maxRep);
b1s = zeros(maxRep,1);
b3s = zeros(maxRep,1);

for n = 1:maxRep
    % define and solve ODEs
    m = ms(n);
    ode2 = @(t,b) [
    (m-1)*b(1)-(3/4)*b(1)^3+(3/4)*b(2)*b(1)^2-(3/2)*b(1)*b(2)^2;...
    (m-9)*b(2)-(1/4)*b(2)^3-(3/2)*b(2)*b(1)^2+(3/4)*b(1)^3];
    [~,b] = ode45(ode2,[0,20],[2/sqrt(6);0]);
    b1s(n)=abs(b(end,1)-2*sqrt((m-1)/3));
    b3s(n)=abs(b(end,2));
end

hold on
plot(ms, b1s, ms, b3s);
legend('E1','E3')
axis([1.1 20 0 3.5])
xlabel("m")
ylabel("absolute error")
hold off

%% 5 Terms
maxRep = 100;
ms = linspace(1.1, 50, maxRep);
b1s_2 = zeros(maxRep,1);
b3s_2 = zeros(maxRep,1);

b1s_5 = zeros(maxRep,1);
b3s_5 = zeros(maxRep,1);
b5s_5 = zeros(maxRep,1);
b7s_5 = zeros(maxRep,1);
b9s_5 = zeros(maxRep,1);

for n = 1:maxRep
    n
    % define and solve ODEs
    m = ms(n);

    %get initial values
    ode2 = @(t,b) [
    (m-1)*b(1)-(3/4)*b(1)^3+(3/4)*b(2)*b(1)^2-(3/2)*b(1)*b(2)^2;...
    (m-9)*b(2)-(1/4)*b(2)^3-(3/2)*b(2)*b(1)^2+(3/4)*b(1)^3];
    [~,b1] = ode45(ode2,[0,20],[2/sqrt(6);0]);
    b1s_2(n)=abs(b1(end,1)-2*sqrt((m-1)/3));
    b3s_2(n)=abs(b1(end,2));
   
    % solve 5 dim
    ode5 = @(t,b) [
    (m-1)*b(1)-((3*b(1)^3)/4 - (3*b(1)^2*b(2))/4 + (3*b(1)*b(2)^2)/2 - ...
         (3*b(1)*b(2)*b(3))/2 + (3*b(2)^2*b(3))/4 + (3*b(1)*b(3)^2)/2 - ...
         (3*b(2)^2*b(4))/4 - (3*b(1)*b(3)*b(4))/2 + (3*b(2)*b(3)*b(4))/2 + ...
         (3*b(1)*b(4)^2)/2 - (3*b(2)*b(3)*b(5))/2 + (3*b(3)^2*b(5))/4 - ...
         (3*b(1)*b(4)*b(5))/2 + (3*b(2)*b(4)*b(5))/2 + (3*b(1)*b(5)^2)/2);...
    (m-9)*b(2)-(-(b(1)^3/4) + (3*b(1)^2*b(2))/2 + (3*b(2)^3)/4 - ...
         (3*b(1)^2*b(3))/4 + (3*b(1)*b(2)*b(3))/2 + (3*b(2)*b(3)^2)/2 - ...
         (3*b(1)*b(2)*b(4))/2 + (3*b(1)*b(3)*b(4))/2 + (3*b(3)^2*b(4))/4 + ...
         (3*b(2)*b(4)^2)/2 - (3*b(2)^2*b(5))/4 - (3*b(1)*b(3)*b(5))/2 + ...
         (3*b(1)*b(4)*b(5))/2 + (3*b(3)*b(4)*b(5))/2 + (3*b(2)*b(5)^2)/2);...
    (m-25)*b(3)-(-((3*b(1)^2*b(2))/4) + (3*b(1)*b(2)^2)/4 + (3*b(1)^2*b(3))/2 + ...
         (3*b(2)^2*b(3))/2 + (3*b(3)^3)/4 - (3*b(1)^2*b(4))/4 + ...
         (3*b(1)*b(2)*b(4))/2 + (3*b(2)*b(3)*b(4))/2 + (3*b(3)*b(4)^2)/2 - ...
         (3*b(1)*b(2)*b(5))/2 + (3*b(1)*b(3)*b(5))/2 + (3*b(2)*b(4)*b(5))/2 + ...
         (3*b(4)^2*b(5))/4 + (3*b(3)*b(5)^2)/2);
    (m-49)*b(4)-(-((3*b(1)^2*b(2))/4) + (3*b(1)*b(2)^2)/4 + (3*b(1)^2*b(3))/2 + ...
         (3*b(2)^2*b(3))/2 + (3*b(3)^3)/4 - (3*b(1)^2*b(4))/4 + ...
         (3*b(1)*b(2)*b(4))/2 + (3*b(2)*b(3)*b(4))/2 + (3*b(3)*b(4)^2)/2 - ...
         (3*b(1)*b(2)*b(5))/2 + (3*b(1)*b(3)*b(5))/2 + (3*b(2)*b(4)*b(5))/2 + ...
         (3*b(4)^2*b(5))/4 + (3*b(3)*b(5)^2)/2);
    (m-81)*b(5)-(-((3*b(1)^2*b(2))/4) + (3*b(1)*b(2)^2)/4 + (3*b(1)^2*b(3))/2 + ...
         (3*b(2)^2*b(3))/2 + (3*b(3)^3)/4 - (3*b(1)^2*b(4))/4 + ...
         (3*b(1)*b(2)*b(4))/2 + (3*b(2)*b(3)*b(4))/2 + (3*b(3)*b(4)^2)/2 - ...
         (3*b(1)*b(2)*b(5))/2 + (3*b(1)*b(3)*b(5))/2 + (3*b(2)*b(4)*b(5))/2 + ...
         (3*b(4)^2*b(5))/4 + (3*b(3)*b(5)^2)/2)];

    [t,b2] = ode45(ode5,[0,20],[b1s_2(n);b3s_2(n);0;0;0]);
    b1s_5(n)=abs(b2(end,1)-b2(end,1));
    b3s_5(n)=abs(b2(end,2)-b2(end,2));
    b5s_5(n)=abs(b2(end,3));
    b7s_5(n)=abs(b2(end,4));
    b9s_5(n)=abs(b2(end,5));
end

figure;
hold on
plot(ms, b1s_5, ms, b3s_5, ms, b5s_5, ms, b7s_5, ms, b9s_5);
legend('E1','E3','E5','E7','E9')
xlabel("m")
ylabel("absolute error")
axis([1.1 50 0 2.5])
hold off










  